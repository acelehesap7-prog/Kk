name: Deployname: Deploy to Productionname: Deploy to GitHub Pages



on:

  push:

    branches:on:on:

      - main

  pull_request:  push:  push:

    branches:

      - main    branches: [main]    branches: ["main"]



jobs:  pull_request:  workflow_dispatch:

  build:

    runs-on: ubuntu-latest    branches: [main]

    

    env:permissions:

      NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}

      NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}jobs:  contents: read

      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}

      VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}  build-and-deploy:  pages: write

      VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

    runs-on: ubuntu-latest  id-token: write

    steps:

      - name: Checkout Repository

        uses: actions/checkout@v4

    steps:concurrency:

      - name: Setup Node.js Environment

        uses: actions/setup-node@v4      - name: Checkout repository  group: "pages"

        with:

          node-version: '20'        uses: actions/checkout@v4  cancel-in-progress: false

          cache: 'npm'



      - name: Install Dependencies

        run: |      - name: Setup Node.jsjobs:

          npm ci

          npm install --global vercel@latest        uses: actions/setup-node@v4  build:



      - name: Run Type Check        with:    runs-on: ubuntu-latest

        run: npm run typecheck

          node-version: '20'    steps:

      - name: Run Lint Check

        run: npm run lint          cache: 'npm'      - name: Checkout



      - name: Build Application        uses: actions/checkout@v4

        run: npm run build

      - name: Install dependencies      

  deploy:

    needs: build        run: npm ci      - name: Setup Node

    runs-on: ubuntu-latest

    if: github.ref == 'refs/heads/main'        uses: actions/setup-node@v4

    

    env:      - name: Install Vercel CLI        with:

      NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}

      NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}        run: npm install --global vercel@latest          node-version: "20"

      VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}

      VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}          cache: 'npm'

      VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

      - name: Pull Vercel Environment Information          

    steps:

      - name: Checkout Repository        run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}      - name: Install dependencies

        uses: actions/checkout@v4

        run: npm install

      - name: Setup Node.js Environment

        uses: actions/setup-node@v4      - name: Build Project Artifacts        

        with:

          node-version: '20'        run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}      - name: Build static site

          cache: 'npm'

        env:        run: npm run build

      - name: Install Dependencies

        run: |          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}        env:

          npm ci

          npm install --global vercel@latest          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}          NODE_ENV: production



      - name: Pull Vercel Environment          NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}

        run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

      - name: Deploy to Vercel          NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}

      - name: Build Project

        run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}        run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}        



      - name: Deploy to Vercel        env:      - name: Add .nojekyll file

        run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}        run: touch ./out/.nojekyll

          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}        

          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}      - name: Remove CNAME if exists
        run: rm -f ./out/CNAME
        
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./out

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
